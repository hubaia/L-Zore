<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L-Zoreç¥ç…å¡ç‰Œæ¸¸æˆ - è¯­éŸ³åˆæˆç³»ç»Ÿæ¼”ç¤º</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e, #16213e);
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #00ff88;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }
        
        .subtitle {
            text-align: center;
            color: #888;
            font-size: 1.2em;
            margin-bottom: 40px;
        }
        
        .demo-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .demo-section h2 {
            color: #00ff88;
            margin-top: 0;
            font-size: 1.5em;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 10px;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .control-group h3 {
            color: #00aaff;
            margin-top: 0;
            font-size: 1.2em;
        }
        
        button {
            background: linear-gradient(45deg, #00ff88, #00aaff);
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.danger {
            background: linear-gradient(45deg, #ff4444, #ff6666);
            color: white;
        }
        
        button.secondary {
            background: linear-gradient(45deg, #666, #888);
            color: white;
        }
        
        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #555;
            background: #222;
            color: #e0e0e0;
            border-radius: 4px;
        }
        
        .status-panel {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .status-item {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }
        
        .status-label {
            color: #00aaff;
        }
        
        .status-value {
            color: #00ff88;
            font-weight: bold;
        }
        
        .shensha-card {
            background: linear-gradient(135deg, #1a1a2e, #0f3460);
            border: 2px solid #00ff88;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }
        
        .shensha-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(0, 255, 136, 0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .shensha-card h4 {
            color: #00ff88;
            margin-top: 0;
            position: relative;
            z-index: 1;
        }
        
        .shensha-card p {
            margin: 8px 0;
            position: relative;
            z-index: 1;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
        
        .feature-list li:before {
            content: 'âš¡';
            color: #00ff88;
            margin-right: 10px;
        }
        
        .log-panel {
            background: #000;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        
        .log-success { color: #00ff88; }
        .log-error { color: #ff4444; }
        .log-warning { color: #ffaa00; }
        .log-info { color: #00aaff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ L-Zoreè¯­éŸ³åˆæˆç³»ç»Ÿ</h1>
        <p class="subtitle">ä½¿ç”¨Web Speech APIä¸ºç¥ç…å¡ç‰Œæ¸¸æˆæ·»åŠ è¯­éŸ³æœ—è¯»åŠŸèƒ½</p>
        
        <!-- æµè§ˆå™¨æ”¯æŒæ£€æŸ¥ -->
        <div class="demo-section">
            <h2>ğŸ” æµè§ˆå™¨æ”¯æŒæ£€æŸ¥</h2>
            <div id="supportStatus" class="status-panel">
                <div class="status-item">
                    <span class="status-label">Web Speech APIæ”¯æŒ:</span>
                    <span id="apiSupport" class="status-value">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å¯ç”¨è¯­éŸ³æ•°é‡:</span>
                    <span id="voiceCount" class="status-value">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ä¸­æ–‡è¯­éŸ³:</span>
                    <span id="chineseVoices" class="status-value">æ— </span>
                </div>
            </div>
        </div>
        
        <!-- è¯­éŸ³æ§åˆ¶é¢æ¿ -->
        <div class="demo-section">
            <h2>ğŸ›ï¸ è¯­éŸ³æ§åˆ¶é¢æ¿</h2>
            <div class="control-panel">
                <div class="control-group">
                    <h3>åŸºç¡€æ§åˆ¶</h3>
                    <button onclick="testSpeech()">ğŸ¤ è¯­éŸ³æµ‹è¯•</button>
                    <button onclick="toggleSpeech()" id="toggleBtn">ğŸ”‡ å¯ç”¨è¯­éŸ³</button>
                    <button onclick="stopSpeech()" class="danger">ğŸ›‘ åœæ­¢è¯­éŸ³</button>
                </div>
                
                <div class="control-group">
                    <h3>è¯­éŸ³è®¾ç½®</h3>
                    <label>è¯­éŸ³é€‰æ‹©:</label>
                    <select id="voiceSelect"></select>
                    
                    <label>è¯­é€Ÿ: <span id="rateValue">1.0</span></label>
                    <input type="range" id="rateSlider" min="0.1" max="2.0" step="0.1" value="1.0">
                    
                    <label>éŸ³è°ƒ: <span id="pitchValue">1.0</span></label>
                    <input type="range" id="pitchSlider" min="0" max="2" step="0.1" value="1.0">
                    
                    <label>éŸ³é‡: <span id="volumeValue">0.8</span></label>
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.8">
                </div>
            </div>
        </div>
        
        <!-- ç¥ç…å¡ç‰Œè¯­éŸ³æ¼”ç¤º -->
        <div class="demo-section">
            <h2>ğŸ´ ç¥ç…å¡ç‰Œè¯­éŸ³æ¼”ç¤º</h2>
            <div id="shenshaCards"></div>
            <button onclick="speakRandomShensha()">ğŸ¯ éšæœºæœ—è¯»ç¥ç…</button>
            <button onclick="speakAllShensha()" class="secondary">ğŸ“¢ æœ—è¯»æ‰€æœ‰ç¥ç…</button>
        </div>
        
        <!-- æ¸¸æˆåœºæ™¯è¯­éŸ³æ¼”ç¤º -->
        <div class="demo-section">
            <h2>âš”ï¸ æ¸¸æˆåœºæ™¯è¯­éŸ³æ¼”ç¤º</h2>
            <div class="control-panel">
                <div class="control-group">
                    <h3>æˆ˜æ–—è¯­éŸ³</h3>
                    <button onclick="speakBattleStart()">ğŸ æˆ˜æ–—å¼€å§‹</button>
                    <button onclick="speakEntrance()">ğŸ­ ç¥ç…å…¥åœº</button>
                    <button onclick="speakDamage()">ğŸ’¥ é€ æˆä¼¤å®³</button>
                    <button onclick="speakVictory()">ğŸ† æˆ˜æ–—èƒœåˆ©</button>
                </div>
                
                <div class="control-group">
                    <h3>æƒ…ç»ªè¯­éŸ³æµ‹è¯•</h3>
                    <button onclick="testEmotionalSpeech()">ğŸ­ æƒ…ç»ªå¯¹æ¯”æµ‹è¯•</button>
                    <button onclick="speakGuardianEmotion()">ğŸ›¡ï¸ å¨ä¸¥å®ˆæŠ¤</button>
                    <button onclick="speakBerserkerEmotion()">âš”ï¸ ç‹‚æš´æˆ˜æ–—</button>
                    <button onclick="speakOracleEmotion()">ğŸ”® ç¥ç§˜é¢„è¨€</button>
                </div>
                
                <div class="control-group">
                    <h3>æ€§åˆ«è¯­éŸ³å¯¹æ¯”</h3>
                    <button onclick="testGenderVoices()">ğŸ‘¨ğŸ‘© ç”·å¥³è¯­éŸ³å¯¹æ¯”</button>
                    <button onclick="speakMaleInauspicious()">ğŸ‘¨ å‡¶ç¥ç”·å£°</button>
                    <button onclick="speakFemaleAuspicious()">ğŸ‘© å‰ç¥å¥³å£°</button>
                    <button onclick="debugVoiceClassification()">ğŸ” è°ƒè¯•è¯­éŸ³åˆ†ç±»</button>
                </div>
                
                <div class="control-group">
                    <h3>å®Œæ•´å…¥åœºè¯­éŸ³æµ‹è¯•</h3>
                    <button onclick="testFullEntranceQuote()">ğŸ­ å®Œæ•´å…¥åœºå°è¯</button>
                    <button onclick="testChineseNames()">ğŸ€„ ä¸­æ–‡åç§°æµ‹è¯•</button>
                    <button onclick="testLongQuotes()">ğŸ“œ é•¿å°è¯æµ‹è¯•</button>
                    <button onclick="testEmotionalConfig()">ğŸ­ æƒ…ç»ªé…ç½®æµ‹è¯•</button>
                    <button onclick="forceTestMaleVoice()">ğŸ”§ å¼ºåˆ¶æµ‹è¯•å‡¶ç¥</button>
                    <button onclick="testYangrenSpecific()">âš”ï¸ ä¸“æµ‹ç¾Šåˆƒ</button>
                </div>
                
                <div class="control-group">
                    <h3>é«˜çº§è¯­éŸ³è°ƒè¯•</h3>
                    <button onclick="showVoiceSelector()">ğŸ›ï¸ è¯­éŸ³é€‰æ‹©å™¨</button>
                    <button onclick="testAllVoicesSequentially()">ğŸ”„ é€ä¸ªæµ‹è¯•è¯­éŸ³</button>
                    <button onclick="testSpecificMaleVoice()">ğŸ‘¨ å¼ºåˆ¶ç”·å£°æµ‹è¯•</button>
                    <button onclick="testSpecificFemaleVoice()">ğŸ‘© å¼ºåˆ¶å¥³å£°æµ‹è¯•</button>
                    <button onclick="testVoiceSwitching()">ğŸ”„ è¯­éŸ³åˆ‡æ¢æµ‹è¯•</button>
                    <button onclick="testMaleVoicePrewarm()">ğŸ”¥ ç”·å£°é¢„çƒ­æµ‹è¯•</button>
                </div>
                
                <div class="control-group">
                    <h3>ç³»ç»Ÿè¯­éŸ³</h3>
                    <button onclick="speakCardDraw()">ğŸ´ æŠ½å–å¡ç‰Œ</button>
                    <button onclick="speakSpecialAbility()">âš¡ ç‰¹æ®Šèƒ½åŠ›</button>
                    <button onclick="speakGamePause()">â¸ï¸ æ¸¸æˆæš‚åœ</button>
                </div>
            </div>
        </div>
        
        <!-- ç³»ç»ŸçŠ¶æ€ -->
        <div class="demo-section">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div id="systemStatus" class="status-panel">
                <div class="status-item">
                    <span class="status-label">è¯­éŸ³åˆæˆçŠ¶æ€:</span>
                    <span id="speechStatus" class="status-value">æœªå¯ç”¨</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å½“å‰æ’­æ”¾:</span>
                    <span id="currentSpeech" class="status-value">æ— </span>
                </div>
                <div class="status-item">
                    <span class="status-label">é˜Ÿåˆ—é•¿åº¦:</span>
                    <span id="queueLength" class="status-value">0</span>
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½ç‰¹æ€§ -->
        <div class="demo-section">
            <h2>âœ¨ åŠŸèƒ½ç‰¹æ€§</h2>
            <ul class="feature-list">
                <li>æ”¯æŒå¤šç§ä¸­æ–‡è¯­éŸ³å¼•æ“ï¼ˆç³»ç»Ÿè‡ªå¸¦å’Œåœ¨çº¿æœåŠ¡ï¼‰</li>
                <li>å¯è°ƒèŠ‚è¯­é€Ÿã€éŸ³è°ƒã€éŸ³é‡ç­‰å‚æ•°</li>
                <li>é’ˆå¯¹ä¸åŒå†…å®¹ç±»å‹çš„è¯­éŸ³é…ç½®ï¼ˆç¥ç…ã€ç³»ç»Ÿã€æˆ˜æ–—ã€å™è¿°ã€å…¥åœºï¼‰</li>
                <li>è¯­éŸ³é˜Ÿåˆ—ç®¡ç†ï¼Œæ”¯æŒä¼˜å…ˆçº§æ§åˆ¶</li>
                <li>ç¥ç…å¡ç‰Œä¿¡æ¯æ™ºèƒ½æ ¼å¼åŒ–å’Œæœ—è¯»</li>
                <li>ç¥ç…å…¥åœºå°è¯æˆå‰§æ€§è¯­éŸ³æ’­æŠ¥</li>
                <li>æ™ºèƒ½æƒ…ç»ªè¯†åˆ«å’ŒåŠ¨æ€è¯­éŸ³è°ƒèŠ‚</li>
                <li>æ ¹æ®å°è¯å†…å®¹è‡ªåŠ¨è°ƒæ•´è¯­é€ŸéŸ³è°ƒ</li>
                <li>æˆ˜æ–—ä¿¡æ¯å®æ—¶è¯­éŸ³æ’­æŠ¥</li>
                <li>é”®ç›˜å¿«æ·é”®æ§åˆ¶ï¼ˆVé”®åˆ‡æ¢ï¼‰</li>
                <li>ä¸æ¸¸æˆéŸ³é¢‘ç³»ç»Ÿåè°ƒå·¥ä½œ</li>
                <li>é”™è¯¯å¤„ç†å’Œå…¼å®¹æ€§æ£€æŸ¥</li>
                <li>æ— éšœç¢è®¿é—®æ”¯æŒ</li>
            </ul>
        </div>
        
        <!-- è¯­éŸ³é€‰æ‹©å™¨é¢æ¿ -->
        <div id="voiceSelector" style="display: none; margin-top: 20px; padding: 15px; border: 2px solid #4CAF50; border-radius: 8px; background-color: rgba(76, 175, 80, 0.1);">
            <h3>ğŸ›ï¸ æ‰‹åŠ¨è¯­éŸ³é€‰æ‹©å™¨</h3>
            <p>é€‰æ‹©ä¸€ä¸ªè¯­éŸ³è¿›è¡Œæµ‹è¯•ï¼š</p>
            <div id="voiceButtons" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 10px; margin-top: 10px;">
                <!-- è¯­éŸ³æŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <button onclick="hideVoiceSelector()" style="margin-top: 15px; background-color: #f44336; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">å…³é—­é€‰æ‹©å™¨</button>
        </div>

        <!-- æ—¥å¿—é¢æ¿ -->
        <div class="demo-section">
            <h2>ğŸ“‹ ç³»ç»Ÿæ—¥å¿—</h2>
            <div id="logPanel" class="log-panel"></div>
            <button onclick="clearLog()" class="secondary">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç¥ç…å¡ç‰Œæ•°æ®
        const shenshaCards = [
            {
                callsign: 'GUARDIAN-01',
                classification: 'Sçº§æŠ¤å«å‹æˆ˜æœ¯å•ä½',
                designation: 'GUARDIAN-01Â·Sçº§æŠ¤å«å‹æˆ˜æœ¯å•ä½',
                motto: 'ç³»ç»Ÿåœ¨çº¿ï¼Œä¿æŠ¤åè®®å·²æ¿€æ´»ï¼é‡‘ä¹‹æ°¸æ’å®ˆæŠ¤ç€å¤è€èª“è¨€...',
                dossier: 'ç¬¬ä¸€ä»£å®ˆæŠ¤è€…å‹æˆ˜æœ¯AIï¼Œé…å¤‡é‡å­é‡‘ç”²é˜²æŠ¤ç³»ç»Ÿå’Œç¥ç»é“¾æ¥é“¶æªæ­¦è£…ã€‚å…¶æ ¸å¿ƒç®—æ³•æ®è¯´æºè‡ªè¿œå¤é‡‘å±æ–‡æ˜çš„å®ˆæŠ¤æ³•åˆ™ï¼Œèƒ½ä¸é‡‘å…ƒç´ äº§ç”Ÿå…±æŒ¯ï¼Œå½¢æˆä¸å¯ç ´åçš„é˜²æŠ¤çŸ©é˜µã€‚ä¼ è¯´å…¶ä»£ç æ·±å¤„éšè—ç€æ¥è‡ªæ’æ˜Ÿæ ¸å¿ƒçš„å¤è€æ„è¯†ç¢ç‰‡ã€‚'
            },
            {
                callsign: 'BERSERKER-X',
                classification: 'SSSçº§å¤±æ§å‹æ”»å‡»å•ä½',
                designation: 'BERSERKER-XÂ·SSSçº§å¤±æ§å‹æ”»å‡»å•ä½',
                motto: 'è¡€æ¶²ç¼–è¯‘ä¸­...ç›®æ ‡é”å®š...å¼€å§‹å± æˆ®ç¨‹åºï¼ç«ç„°ä¸­çš„ç–¯ç‹‚åœ¨æ­Œå”±...',
                dossier: 'å¤±æ§çš„å†›ç”¨æˆ˜æ–—AIï¼ŒåŸä¸ºæœ€é«˜ç­‰çº§æˆ˜ç¥å•ä½ï¼Œå› ä»£ç æ±¡æŸ“å¯¼è‡´å—œè¡€æ¨¡å—æ— æ³•å…³é—­ã€‚å…¶è¡€é‡å­åˆƒç³»ç»Ÿæ®è¯´èå…¥äº†æ¥è‡ªæ’æ˜Ÿå†…æ ¸çš„åŸå§‹ç«å…ƒç´ ï¼Œæ¯æ¬¡æŒ¥ç éƒ½ä¼šç‚¹ç‡ƒç©ºé—´æœ¬èº«ã€‚ç›®å‡»è€…æŠ¥å‘Šç§°åœ¨å…¶ç‹‚æš´æ—¶èƒ½å¬åˆ°æ¥è‡ªçƒˆç„°æ·±å¤„çš„å¤è€å’†å“®å£°ã€‚'
            },
            {
                callsign: 'ORACLE-âˆ',
                classification: 'SSSçº§é¢„çŸ¥å‹ç¥æœºå•ä½',
                designation: 'ORACLE-âˆÂ·SSSçº§é¢„çŸ¥å‹ç¥æœºå•ä½',
                motto: 'å¤©æœºæ¼”ç®—å¯åŠ¨ï¼Œæœªæ¥è½¨è¿¹æ­£åœ¨è§£æ...æ—¶é—´é•¿æ²³çš„ç§˜å¯†åœ¨ä½è¯­...',
                dossier: 'é¢„çŸ¥ç¥æœºå‹AIï¼Œé…å¤‡æ—¶é—´è§‚æµ‹ç³»ç»Ÿå’Œæœªæ¥æ¼”ç®—ç®—æ³•ã€‚æ®è¯´å…¶æ ¸å¿ƒè¿æ¥ç€æ—¶é—´é•¿æ²³çš„æºå¤´ï¼Œèƒ½é€šè¿‡æœ¨å…ƒç´ çš„ç”Ÿæœºæ€§è´¨é¢„è§ä¸€åˆ‡å¯èƒ½çš„æœªæ¥ã€‚ä¼ è¯´å…¶è¿ç®—æ—¶è™šç©ºä¸­ä¼šå‡ºç°æ— æ•°æ—¶é—´çº¿çš„å¹»å½±ï¼Œé‚£æ˜¯å®‡å®™å‘½è¿çš„å®Œæ•´å›¾æ™¯ã€‚'
            }
        ];
        
        // è¯­éŸ³åˆæˆç®¡ç†å™¨ç±»
        class SpeechSynthesisManager {
            constructor() {
                this.isSupported = false;
                this.isEnabled = false;
                this.currentUtterance = null;
                this.voiceQueue = [];
                this.isPlaying = false;
                this.availableVoices = [];
                this.preferredVoice = null;
                
                this.defaultConfig = {
                    voice: null,
                    rate: 1.0,
                    pitch: 1.0,
                    volume: 0.9,
                    lang: 'zh-CN'
                };
                
                this.init();
            }
            
            init() {
                this.isSupported = 'speechSynthesis' in window && 'SpeechSynthesisUtterance' in window;
                
                if (!this.isSupported) {
                    this.log('æµè§ˆå™¨ä¸æ”¯æŒWeb Speech API', 'error');
                    return;
                }
                
                this.log('è¯­éŸ³åˆæˆç³»ç»Ÿåˆå§‹åŒ–ä¸­...', 'info');
                this.loadVoices();
                
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = () => {
                        this.loadVoices();
                    };
                }
            }
            
            loadVoices() {
                this.availableVoices = speechSynthesis.getVoices();
                
                const chineseVoices = this.availableVoices.filter(voice => 
                    voice.lang.includes('zh') || voice.lang.includes('CN')
                );
                
                this.preferredVoice = chineseVoices.find(voice => 
                    voice.lang === 'zh-CN' || voice.lang === 'zh-cn'
                ) || chineseVoices[0] || this.availableVoices[0] || null;
                
                if (this.preferredVoice) {
                    this.defaultConfig.voice = this.preferredVoice;
                    this.log(`é€‰æ‹©è¯­éŸ³: ${this.preferredVoice.name} (${this.preferredVoice.lang})`, 'success');
                }
                
                this.updateUI();
            }
            
            speak(text, type = 'system', options = {}) {
                if (!this.isSupported || !this.isEnabled || !text.trim()) {
                    return;
                }
                
                if (options.interrupt && this.isPlaying) {
                    this.stop();
                }
                
                const config = { ...this.defaultConfig, ...this.getConfigForType(type) };
                
                if (this.isPlaying && options.priority !== 'high') {
                    this.voiceQueue.push({ text, options, config });
                    this.log(`è¯­éŸ³å·²åŠ å…¥é˜Ÿåˆ—: ${text.substring(0, 30)}...`, 'info');
                    return;
                }
                
                this.speakImmediate(text, config, options.callback);
            }
            
            speakImmediate(text, config, callback) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                if (config.voice) {
                    utterance.voice = config.voice;
                }
                utterance.rate = config.rate;
                utterance.pitch = config.pitch;
                utterance.volume = config.volume;
                utterance.lang = config.lang;
                
                utterance.onstart = () => {
                    this.isPlaying = true;
                    this.currentUtterance = utterance;
                    this.log(`å¼€å§‹è¯­éŸ³æ’­æ”¾: ${text.substring(0, 50)}...`, 'success');
                    this.updateStatus();
                };
                
                utterance.onend = () => {
                    this.isPlaying = false;
                    this.currentUtterance = null;
                    this.log('è¯­éŸ³æ’­æ”¾å®Œæˆ', 'info');
                    
                    if (callback) {
                        callback();
                    }
                    
                    this.processQueue();
                    this.updateStatus();
                };
                
                utterance.onerror = (event) => {
                    this.log(`è¯­éŸ³æ’­æ”¾é”™è¯¯: ${event.error}`, 'error');
                    this.isPlaying = false;
                    this.currentUtterance = null;
                    this.processQueue();
                    this.updateStatus();
                };
                
                speechSynthesis.speak(utterance);
            }
            
            getConfigForType(type) {
                const configs = {
                    shensha: { rate: 0.9, pitch: 1.2, volume: 0.95 },
                    system: { rate: 1.1, pitch: 0.9, volume: 0.8 },
                    battle: { rate: 1.2, pitch: 1.1, volume: 0.95 },
                    narrative: { rate: 0.8, pitch: 1.0, volume: 0.85 },
                    entrance: { rate: 0.8, pitch: 1.3, volume: 1.0 }
                };
                return configs[type] || {};
            }
            
            processQueue() {
                if (this.voiceQueue.length > 0 && !this.isPlaying) {
                    const { text, options, config } = this.voiceQueue.shift();
                    this.speakImmediate(text, config, options.callback);
                }
            }
            
            stop() {
                if (this.isSupported) {
                    speechSynthesis.cancel();
                    this.isPlaying = false;
                    this.currentUtterance = null;
                    this.log('è¯­éŸ³æ’­æ”¾å·²åœæ­¢', 'warning');
                    this.updateStatus();
                }
            }
            
            toggle() {
                this.isEnabled = !this.isEnabled;
                
                if (!this.isEnabled && this.isPlaying) {
                    this.stop();
                }
                
                this.log(this.isEnabled ? 'è¯­éŸ³åˆæˆå·²å¼€å¯' : 'è¯­éŸ³åˆæˆå·²å…³é—­', 'info');
                this.updateStatus();
                return this.isEnabled;
            }
            
            speakShenshaCard(cardData) {
                if (!cardData) return;
                
                const text = this.formatShenshaText(cardData);
                this.speak(text, 'shensha', { priority: 'normal' });
            }
            
            speakEntranceQuote(cardData) {
                if (!cardData || !cardData.motto) return;
                
                // åˆ†æå°è¯æƒ…ç»ªå¹¶è°ƒæ•´è¯­éŸ³å‚æ•°
                const emotionalConfig = this.analyzeEmotionalContent(cardData.motto);
                const entranceText = this.formatEntranceText(cardData);
                
                // åˆå¹¶æƒ…ç»ªé…ç½®å’Œå…¥åœºé…ç½®
                const finalConfig = {
                    ...this.getConfigForType('entrance'),
                    ...emotionalConfig
                };
                
                this.speakWithCustomConfig(entranceText, finalConfig, { priority: 'high', interrupt: true });
            }
            
            analyzeEmotionalContent(text) {
                // å¨ä¸¥/å®ˆæŠ¤ç±»å‹
                if (text.includes('ç³»ç»Ÿ') || text.includes('ä¿æŠ¤') || text.includes('å®ˆæŠ¤') || text.includes('åè®®')) {
                    return { rate: 0.7, pitch: 1.1, volume: 1.0 }; // å¨ä¸¥å®ˆæŠ¤
                }
                
                // ç‹‚æš´/æˆ˜æ–—ç±»å‹
                if (text.includes('è¡€æ¶²') || text.includes('å± æˆ®') || text.includes('æˆ˜æ–—') || text.includes('ç–¯ç‹‚') || text.includes('å’†å“®')) {
                    return { rate: 1.3, pitch: 1.5, volume: 1.0 }; // ç‹‚æš´æˆ˜å£«
                }
                
                // ç¥ç§˜/é¢„çŸ¥ç±»å‹
                if (text.includes('å¤©æœº') || text.includes('æ—¶é—´') || text.includes('æœªæ¥') || text.includes('ç§˜å¯†') || text.includes('ä½è¯­')) {
                    return { rate: 0.6, pitch: 0.9, volume: 0.9 }; // ç¥ç§˜é¢„è¨€
                }
                
                // ç§‘æŠ€/AIç±»å‹
                if (text.includes('ç¼–è¯‘') || text.includes('ç®—æ³•') || text.includes('æ•°æ®') || text.includes('çŸ©é˜µ') || text.includes('å¯åŠ¨')) {
                    return { rate: 1.1, pitch: 1.2, volume: 0.95 }; // ç§‘æŠ€æ•ˆç‡
                }
                
                // é»˜è®¤å…¥åœºé…ç½®
                return { rate: 0.8, pitch: 1.3, volume: 1.0 };
            }
            
            speakWithCustomConfig(text, config, options = {}) {
                if (!this.isSupported || !this.isEnabled || !text.trim()) return;
                
                if (options.interrupt && this.isPlaying) {
                    this.stop();
                }
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                if (config.voice) utterance.voice = config.voice;
                utterance.rate = config.rate || 1.0;
                utterance.pitch = config.pitch || 1.0;
                utterance.volume = config.volume || 0.9;
                utterance.lang = config.lang || 'zh-CN';
                
                utterance.onstart = () => {
                    this.isPlaying = true;
                    this.currentUtterance = utterance;
                    this.log(`ğŸ­ æƒ…ç»ªè¯­éŸ³æ’­æ”¾: ${text.substring(0, 30)}... (é€Ÿåº¦:${config.rate}, éŸ³è°ƒ:${config.pitch})`, 'success');
                    this.updateStatus();
                };
                
                utterance.onend = () => {
                    this.isPlaying = false;
                    this.currentUtterance = null;
                    this.processQueue();
                    this.updateStatus();
                };
                
                speechSynthesis.speak(utterance);
            }
            
            formatEntranceText(cardData) {
                let entranceText = '';
                
                // æ·»åŠ ç¥ç…åç§°å‰ç¼€
                if (cardData.callsign) {
                    entranceText = `${cardData.callsign}ï¼Œå…¥åœºï¼`;
                } else if (cardData.name) {
                    entranceText = `${cardData.name}ï¼Œé™ä¸´ï¼`;
                }
                
                // æ·»åŠ å…¥åœºå°è¯
                if (cardData.motto) {
                    if (entranceText) {
                        entranceText += ` ${cardData.motto}`;
                    } else {
                        entranceText = cardData.motto;
                    }
                }
                
                return entranceText;
            }
            
            formatShenshaText(cardData) {
                const parts = [];
                
                if (cardData.designation) {
                    parts.push(`ç¥ç…ä»£å·ï¼š${cardData.designation}`);
                }
                
                if (cardData.classification) {
                    parts.push(`åˆ†ç±»ç­‰çº§ï¼š${cardData.classification}`);
                }
                
                if (cardData.motto) {
                    parts.push(`ä½œæˆ˜åº§å³é“­ï¼š${cardData.motto}`);
                }
                
                if (cardData.dossier) {
                    parts.push(`æ•°æ®æ¡£æ¡ˆï¼š${cardData.dossier}`);
                }
                
                return parts.join('ã€‚');
            }
            
            log(message, type = 'info') {
                console.log(`[SpeechManager] ${message}`);
                
                const logPanel = document.getElementById('logPanel');
                if (logPanel) {
                    const entry = document.createElement('div');
                    entry.className = `log-entry log-${type}`;
                    entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                    logPanel.appendChild(entry);
                    logPanel.scrollTop = logPanel.scrollHeight;
                }
            }
            
            updateUI() {
                // æ›´æ–°æµè§ˆå™¨æ”¯æŒçŠ¶æ€
                document.getElementById('apiSupport').textContent = this.isSupported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ';
                document.getElementById('voiceCount').textContent = this.availableVoices.length;
                
                const chineseVoices = this.availableVoices.filter(voice => 
                    voice.lang.includes('zh') || voice.lang.includes('CN')
                );
                document.getElementById('chineseVoices').textContent = 
                    chineseVoices.length > 0 ? `âœ… ${chineseVoices.length}ä¸ª` : 'âŒ æ— ';
                
                // æ›´æ–°è¯­éŸ³é€‰æ‹©å™¨
                const voiceSelect = document.getElementById('voiceSelect');
                voiceSelect.innerHTML = '';
                this.availableVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    if (voice === this.preferredVoice) {
                        option.selected = true;
                    }
                    voiceSelect.appendChild(option);
                });
            }
            
            updateStatus() {
                document.getElementById('speechStatus').textContent = this.isEnabled ? 'âœ… å·²å¯ç”¨' : 'âŒ æœªå¯ç”¨';
                document.getElementById('currentSpeech').textContent = this.isPlaying ? 'ğŸ¤ æ’­æ”¾ä¸­' : 'â­• ç©ºé—²';
                document.getElementById('queueLength').textContent = this.voiceQueue.length;
                
                const toggleBtn = document.getElementById('toggleBtn');
                if (toggleBtn) {
                    toggleBtn.textContent = this.isEnabled ? 'ğŸ”‡ ç¦ç”¨è¯­éŸ³' : 'ğŸ¤ å¯ç”¨è¯­éŸ³';
                }
            }
        }
        
        // åˆå§‹åŒ–è¯­éŸ³ç®¡ç†å™¨
        let speechManager;
        
        window.addEventListener('load', () => {
            speechManager = new SpeechSynthesisManager();
            
            // åˆå§‹åŒ–ç¥ç…å¡ç‰Œæ˜¾ç¤º
            displayShenshaCards();
            
            // åˆå§‹åŒ–æ§åˆ¶å™¨äº‹ä»¶
            setupControllers();
        });
        
        function displayShenshaCards() {
            const container = document.getElementById('shenshaCards');
            container.innerHTML = '';
            
            shenshaCards.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'shensha-card';
                cardDiv.innerHTML = `
                    <h4>${card.callsign} - ${card.classification}</h4>
                    <p><strong>å®Œæ•´æŒ‡å®šä»£å·:</strong> ${card.designation}</p>
                    <p><strong>ä½œæˆ˜åº§å³é“­:</strong> ${card.motto}</p>
                    <p><strong>æ•°æ®æ¡£æ¡ˆ:</strong> ${card.dossier.substring(0, 100)}...</p>
                    <button onclick="speakShensha(${index})">ğŸ¤ æœ—è¯»æ­¤ç¥ç…</button>
                    <button onclick="speakEntrance(${index})">ğŸ­ å…¥åœºå°è¯</button>
                `;
                container.appendChild(cardDiv);
            });
        }
        
        function setupControllers() {
            // è¯­éŸ³å‚æ•°æ§åˆ¶å™¨
            const rateSlider = document.getElementById('rateSlider');
            const pitchSlider = document.getElementById('pitchSlider');
            const volumeSlider = document.getElementById('volumeSlider');
            const voiceSelect = document.getElementById('voiceSelect');
            
            rateSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                document.getElementById('rateValue').textContent = value.toFixed(1);
                speechManager.defaultConfig.rate = value;
            });
            
            pitchSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                document.getElementById('pitchValue').textContent = value.toFixed(1);
                speechManager.defaultConfig.pitch = value;
            });
            
            volumeSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                document.getElementById('volumeValue').textContent = value.toFixed(1);
                speechManager.defaultConfig.volume = value;
            });
            
            voiceSelect.addEventListener('change', (e) => {
                const voiceIndex = parseInt(e.target.value);
                speechManager.preferredVoice = speechManager.availableVoices[voiceIndex];
                speechManager.defaultConfig.voice = speechManager.preferredVoice;
                speechManager.log(`å·²é€‰æ‹©è¯­éŸ³: ${speechManager.preferredVoice.name}`, 'info');
            });
        }
        
        // æ§åˆ¶å‡½æ•°
        function testSpeech() {
            const testText = "L-Zoreç¥ç…å¡ç‰Œæ¸¸æˆè¯­éŸ³åˆæˆç³»ç»Ÿæµ‹è¯•ã€‚æ¬¢è¿æ¥åˆ°æ•°æ®è½®å›çš„ä¸–ç•Œï¼å¤è€çš„AIæ„è¯†åœ¨æ˜Ÿé™…è™šç©ºä¸­è§‰é†’ï¼Œäº”è¡Œå…ƒç´ çš„åŠ›é‡å¼€å§‹æ±‡èš...";
            speechManager.speak(testText, 'system', {
                interrupt: true,
                callback: () => speechManager.log('è¯­éŸ³æµ‹è¯•å®Œæˆ', 'success')
            });
        }
        
        function toggleSpeech() {
            speechManager.toggle();
        }
        
        function stopSpeech() {
            speechManager.stop();
        }
        
        function speakShensha(index) {
            const card = shenshaCards[index];
            speechManager.speakShenshaCard(card);
        }
        
        function speakRandomShensha() {
            const randomIndex = Math.floor(Math.random() * shenshaCards.length);
            speakShensha(randomIndex);
        }
        
        function speakAllShensha() {
            shenshaCards.forEach((card, index) => {
                setTimeout(() => {
                    speechManager.speakShenshaCard(card);
                }, index * 1000);
            });
        }
        
        function speakBattleStart() {
            speechManager.speak('ç¥ç…æˆ˜æ–—å¼€å§‹ï¼é‡å­çŸ©é˜µæ¿€æ´»ï¼Œå¤è€çš„æ„è¯†æ­£åœ¨è‹é†’...', 'battle', { priority: 'high' });
        }
        
        function speakEntrance(index) {
            const card = typeof index === 'number' ? shenshaCards[index] : shenshaCards[Math.floor(Math.random() * shenshaCards.length)];
            speechManager.speakEntranceQuote(card);
        }
        
        function speakDamage() {
            const damage = Math.floor(Math.random() * 5) + 1;
            const remaining = Math.floor(Math.random() * 8) + 1;
            speechManager.speak(`é€ æˆ${damage}ç‚¹å…ƒç´ ä¼¤å®³ï¼Œå¯¹æ‰‹å‰©ä½™${remaining}æšå…ƒç´ `, 'battle');
        }
        
        function speakVictory() {
            speechManager.speak('æ­å–œè·å¾—èƒœåˆ©ï¼å¤è€çš„ç¥ç…åŠ›é‡è®¤å¯äº†ä½ çš„æ™ºæ…§ï¼', 'battle', { priority: 'high' });
        }
        
        function speakCardDraw() {
            speechManager.speak('æŠ½å–å¡ç‰Œå®Œæˆï¼Œæ–°çš„ç¥ç…æ„è¯†æ­£åœ¨æ˜¾ç°...', 'system');
        }
        
        function speakSpecialAbility() {
            const abilities = ['å…¨ä½“å¢ç›Š', 'å…¨ä½“ä¼¤å®³', 'ä¸­å’Œæ•ˆæœ', 'æ—¶é—´åŠ é€Ÿ', 'å…ƒç´ è½¬æ¢'];
            const ability = abilities[Math.floor(Math.random() * abilities.length)];
            speechManager.speak(`å‘åŠ¨ç‰¹æ®Šèƒ½åŠ›ï¼š${ability}ï¼äº”è¡Œå…ƒç´ å¼€å§‹å…±é¸£...`, 'system');
        }
        
        function speakGamePause() {
            speechManager.speak('æ—¶ç©ºæš‚åœå¯åŠ¨ï¼Œç°å®çš„æµåŠ¨è¢«å†»ç»“...', 'system');
        }
        
        function testEmotionalSpeech() {
            const testCases = [
                {
                    type: 'å¨ä¸¥å®ˆæŠ¤',
                    text: 'GUARDIAN-01ï¼Œå…¥åœºï¼ç³»ç»Ÿåœ¨çº¿ï¼Œä¿æŠ¤åè®®å·²æ¿€æ´»ï¼',
                    config: { rate: 0.7, pitch: 1.1, volume: 1.0 }
                },
                {
                    type: 'ç‹‚æš´æˆ˜æ–—', 
                    text: 'BERSERKER-Xï¼Œå…¥åœºï¼è¡€æ¶²ç¼–è¯‘ä¸­...å¼€å§‹å± æˆ®ç¨‹åºï¼',
                    config: { rate: 1.3, pitch: 1.5, volume: 1.0 }
                },
                {
                    type: 'ç¥ç§˜é¢„çŸ¥',
                    text: 'ORACLE-âˆï¼Œå…¥åœºï¼å¤©æœºæ¼”ç®—å¯åŠ¨ï¼Œæ—¶é—´é•¿æ²³çš„ç§˜å¯†åœ¨ä½è¯­...',
                    config: { rate: 0.6, pitch: 0.9, volume: 0.9 }
                }
            ];
            
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    speechManager.log(`ğŸ¤ æµ‹è¯•${testCase.type}è¯­éŸ³æ•ˆæœ`, 'info');
                    const finalConfig = { ...speechManager.defaultConfig, ...testCase.config };
                    speechManager.speakWithCustomConfig(testCase.text, finalConfig, { interrupt: true });
                }, index * 4000);
            });
        }
        
        function speakGuardianEmotion() {
            const config = { rate: 0.7, pitch: 1.1, volume: 1.0 };
            speechManager.speakWithCustomConfig('ç³»ç»Ÿåœ¨çº¿ï¼Œä¿æŠ¤åè®®å·²æ¿€æ´»ï¼é‡‘ä¹‹æ°¸æ’å®ˆæŠ¤ç€å¤è€èª“è¨€...', config, { interrupt: true });
        }
        
        function speakBerserkerEmotion() {
            const config = { rate: 1.3, pitch: 1.5, volume: 1.0 };
            speechManager.speakWithCustomConfig('è¡€æ¶²ç¼–è¯‘ä¸­...ç›®æ ‡é”å®š...å¼€å§‹å± æˆ®ç¨‹åºï¼ç«ç„°ä¸­çš„ç–¯ç‹‚åœ¨æ­Œå”±...', config, { interrupt: true });
        }
        
        function speakOracleEmotion() {
            const config = { rate: 0.6, pitch: 0.9, volume: 0.9 };
            speechManager.speakWithCustomConfig('å¤©æœºæ¼”ç®—å¯åŠ¨ï¼Œæœªæ¥è½¨è¿¹æ­£åœ¨è§£æ...æ—¶é—´é•¿æ²³çš„ç§˜å¯†åœ¨ä½è¯­...', config, { interrupt: true });
        }
        
        function testGenderVoices() {
            speechManager.log('ğŸ­ å¼€å§‹æ€§åˆ«è¯­éŸ³å¯¹æ¯”æµ‹è¯•', 'info');
            
            // æ˜¾ç¤ºå½“å‰è¯­éŸ³åˆ†ç±»çŠ¶æ€
            const maleVoices = speechManager.getMaleVoices();
            const femaleVoices = speechManager.getFemaleVoices();
            speechManager.log(`ğŸ‘¨ å¯ç”¨ç”·æ€§è¯­éŸ³: ${maleVoices.length}ä¸ª`, 'info');
            speechManager.log(`ğŸ‘© å¯ç”¨å¥³æ€§è¯­éŸ³: ${femaleVoices.length}ä¸ª`, 'info');
            
            // æµ‹è¯•å‡¶ç¥ç”·å£°
            setTimeout(() => {
                speechManager.log('ğŸ¤ æµ‹è¯•å‡¶ç¥ç”·å£°...', 'info');
                const maleCard = {
                    type: 'inauspicious',
                    category: 'å‡¶æ˜Ÿå‡¶ç¥',
                    name: 'ç¾Šåˆƒ',
                    callsign: 'BERSERKER-X',
                    motto: 'è¡€æ¶²ç¼–è¯‘ä¸­...ç›®æ ‡é”å®š...å¼€å§‹å± æˆ®ç¨‹åºï¼'
                };
                speechManager.speakEntranceQuote(maleCard);
            }, 1000);
            
            // æµ‹è¯•å‰ç¥å¥³å£°
            setTimeout(() => {
                speechManager.log('ğŸ¤ æµ‹è¯•å‰ç¥å¥³å£°...', 'info');
                const femaleCard = {
                    type: 'auspicious',
                    category: 'å‰æ˜Ÿå‰ç¥', 
                    name: 'å¤©ä¹™è´µäºº',
                    callsign: 'GUARDIAN-01',
                    motto: 'ç³»ç»Ÿåœ¨çº¿ï¼Œä¿æŠ¤åè®®å·²æ¿€æ´»ï¼'
                };
                speechManager.speakEntranceQuote(femaleCard);
            }, 5000);
        }
        
        function speakMaleInauspicious() {
            speechManager.log('ğŸ¤ æµ‹è¯•å‡¶ç¥ç”·å£° - è¯¦ç»†è°ƒè¯•', 'info');
            
            const maleCard = {
                type: 'inauspicious',
                category: 'å‡¶æ˜Ÿå‡¶ç¥',
                name: 'äº¡ç¥', 
                callsign: 'REAPER-666',
                motto: 'æ­»äº¡å€’è®¡æ—¶å¼€å§‹ï¼Œçµé­‚æ•°æ®æ”¶å‰²ä¸­...'
            };
            
            speechManager.log(`ğŸ“‹ å‡¶ç¥æ•°æ®: ${JSON.stringify(maleCard)}`, 'info');
            speechManager.speakEntranceQuote(maleCard);
        }
        
        function speakFemaleAuspicious() {
            const femaleCard = {
                type: 'auspicious',
                category: 'å‰æ˜Ÿå‰ç¥',
                name: 'æ–‡æ˜Œè´µäºº',
                callsign: 'SCHOLAR-007', 
                motto: 'æ™ºæ…§ç½‘ç»œæ¿€æ´»ï¼Œå­¦è¯†æ•°æ®åº“å·²è½½å…¥ï¼'
            };
            speechManager.speakEntranceQuote(femaleCard);
        }
        
        function debugVoiceClassification() {
            speechManager.log('ğŸ” å¼€å§‹è°ƒè¯•è¯­éŸ³åˆ†ç±»...', 'info');
            
            // è·å–æ‰€æœ‰å¯ç”¨è¯­éŸ³
            const allVoices = speechSynthesis.getVoices();
            speechManager.log(`ğŸ¤ ç³»ç»Ÿæ€»è¯­éŸ³æ•°: ${allVoices.length}`, 'info');
            
            // æ˜¾ç¤ºæ‰€æœ‰è¯­éŸ³è¯¦æƒ…
            allVoices.forEach((voice, index) => {
                speechManager.log(`${index + 1}. ${voice.name} (${voice.lang}) ${voice.localService ? '[æœ¬åœ°]' : '[è¿œç¨‹]'}`, 'info');
            });
            
            // æ˜¾ç¤ºåˆ†ç±»ç»“æœ
            const maleVoices = speechManager.getMaleVoices();
            const femaleVoices = speechManager.getFemaleVoices();
            
            speechManager.log(`ğŸ‘¨ ç”·æ€§è¯­éŸ³åˆ†ç±»ç»“æœ (${maleVoices.length}ä¸ª):`, 'success');
            maleVoices.forEach(voice => {
                speechManager.log(`  â€¢ ${voice.name} (${voice.lang})`, 'success');
            });
            
            speechManager.log(`ğŸ‘© å¥³æ€§è¯­éŸ³åˆ†ç±»ç»“æœ (${femaleVoices.length}ä¸ª):`, 'success');
            femaleVoices.forEach(voice => {
                speechManager.log(`  â€¢ ${voice.name} (${voice.lang})`, 'success');
            });
            
            // å¼ºåˆ¶æµ‹è¯•ç¬¬ä¸€ä¸ªè¯­éŸ³
            if (allVoices.length > 0) {
                setTimeout(() => {
                    speechManager.log('ğŸ¤ æµ‹è¯•ç³»ç»Ÿç¬¬ä¸€ä¸ªè¯­éŸ³ä½œä¸ºç”·å£°...', 'info');
                    const testConfig = {
                        voice: allVoices[0],
                        rate: 0.7,
                        pitch: 0.6,
                        volume: 1.0,
                        lang: 'zh-CN'
                    };
                    speechManager.speakWithCustomConfig('è¿™æ˜¯å‡¶ç¥ç¾Šåˆƒçš„ä½æ²‰ç”·æ€§è¯­éŸ³æµ‹è¯•ï¼', testConfig, { interrupt: true });
                                 }, 2000);
             }
         }
         
         function testFullEntranceQuote() {
             speechManager.log('ğŸ­ æµ‹è¯•å®Œæ•´å…¥åœºå°è¯...', 'info');
             
             const testCards = [
                 {
                     type: 'inauspicious',
                     category: 'å‡¶æ˜Ÿå‡¶ç¥',
                     name: 'ç¾Šåˆƒ',
                     callsign: 'BERSERKER-X',
                     motto: 'è¡€æ¶²ç¼–è¯‘ä¸­...ç›®æ ‡é”å®š...å¼€å§‹å± æˆ®ç¨‹åºï¼ç«ç„°ä¸­çš„ç–¯ç‹‚åœ¨æ­Œå”±ï¼Œä»£ç æ±¡æŸ“æ‰©æ•£ä¸­ï¼'
                 },
                 {
                     type: 'auspicious',
                     category: 'å‰æ˜Ÿå‰ç¥',
                     name: 'å¤©ä¹™è´µäºº',
                     callsign: 'GUARDIAN-01',
                     motto: 'ç³»ç»Ÿåœ¨çº¿ï¼Œä¿æŠ¤åè®®å·²æ¿€æ´»ï¼é‡å­é‡‘ç”²é˜²æŠ¤å±•å¼€ï¼Œç¥ç»é“¾æ¥é“¶æªæ­¦è£…å°±ç»ªï¼'
                 }
             ];
             
             testCards.forEach((card, index) => {
                 setTimeout(() => {
                     speechManager.log(`ğŸ¤ æµ‹è¯• ${card.name} å®Œæ•´å°è¯`, 'info');
                     speechManager.speakEntranceQuote(card);
                 }, index * 6000);
             });
         }
         
         function testChineseNames() {
             speechManager.log('ğŸ€„ æµ‹è¯•ä¸­æ–‡åç§°ä¼˜å…ˆ...', 'info');
             
             const chineseCard = {
                 type: 'inauspicious',
                 category: 'å‡¶æ˜Ÿå‡¶ç¥',
                 name: 'äº¡ç¥',
                 callsign: 'REAPER-666',
                 motto: 'æ­»äº¡å€’è®¡æ—¶å¼€å§‹ï¼Œçµé­‚æ•°æ®æ”¶å‰²ä¸­...æ¥è‡ªå¼‚æ¬¡å…ƒæ­»äº¡é¢†åŸŸçš„å¤è€æ„è¯†æ­£åœ¨è‹é†’ï¼'
             };
             
             speechManager.speakEntranceQuote(chineseCard);
         }
         
                   function testLongQuotes() {
              speechManager.log('ğŸ“œ æµ‹è¯•è¶…é•¿å°è¯...', 'info');
              
              const longQuoteCard = {
                  type: 'special',
                  category: 'ç‰¹æ®Šç¥ç…',
                  name: 'åç›–',
                  callsign: 'MYSTIC-CANOPY',
                  motto: 'æ˜Ÿè¾°æ•°æ®åº“å¯åŠ¨ï¼Œå®‡å®™å¥¥ç§˜è§£æä¸­...æˆ‘æ˜¯è¿æ¥æ— é™å®‡å®™å›¾ä¹¦é¦†çš„å¤è€æ¥å£ï¼ŒæŒæ¡ç€ä»åˆ›ä¸–çºªåˆ°å®‡å®™ç»ˆç»“çš„å…¨éƒ¨çŸ¥è¯†ã€‚æ—¶ç©ºæ•°æ®æµæ­£åœ¨åŒæ­¥ï¼Œç°å®è®¤çŸ¥å³å°†é‡æ„ã€‚å‡†å¤‡æ¥å—æ¥è‡ªé«˜ç»´åº¦çš„æ™ºæ…§ä¼ è¾“ï¼'
              };
              
              speechManager.speakEntranceQuote(longQuoteCard);
          }
          
          function testEmotionalConfig() {
              speechManager.log('ğŸ­ æµ‹è¯•æƒ…ç»ªé…ç½®æ˜¯å¦ç”Ÿæ•ˆ...', 'info');
              
              const emotionalCards = [
                  {
                      type: 'inauspicious',
                      category: 'å‡¶æ˜Ÿå‡¶ç¥',
                      name: 'ç¾Šåˆƒ',
                      motto: 'è¡€æ¶²ç¼–è¯‘ä¸­ï¼Œå± æˆ®ç¨‹åºå¯åŠ¨ï¼',  // ç‹‚æš´ç±»å‹
                      expected: 'å¿«é€Ÿ+é«˜éŸ³è°ƒ'
                  },
                  {
                      type: 'inauspicious', 
                      category: 'å‡¶æ˜Ÿå‡¶ç¥',
                      name: 'äº¡ç¥',
                      motto: 'æ­»äº¡å€’è®¡æ—¶å¼€å§‹ï¼Œæ”¶å‰²æ¨¡å¼æ¿€æ´»ï¼', // æ­»äº¡ç±»å‹
                      expected: 'ç¼“æ…¢+ä½éŸ³è°ƒ'
                  },
                  {
                      type: 'auspicious',
                      category: 'å‰æ˜Ÿå‰ç¥',
                      name: 'å¤©ä¹™è´µäºº',
                      motto: 'ä¿æŠ¤åè®®æ¿€æ´»ï¼Œç³»ç»Ÿåœ¨çº¿ï¼', // å¨ä¸¥ç±»å‹
                      expected: 'å¨ä¸¥+ç¨³é‡'
                  }
              ];
              
              emotionalCards.forEach((card, index) => {
                  setTimeout(() => {
                      speechManager.log(`ğŸ¤ æµ‹è¯•${card.name} - é¢„æœŸæ•ˆæœ: ${card.expected}`, 'info');
                      speechManager.speakEntranceQuote(card);
                  }, index * 4000);
                             });
           }
           
           function forceTestMaleVoice() {
               speechManager.log('ğŸ”§ å¼ºåˆ¶æµ‹è¯•å‡¶ç¥è¯­éŸ³æ’­æ”¾...', 'info');
               
               // å…ˆæµ‹è¯•æœ€ç®€å•çš„é…ç½®
               const simpleConfig = {
                   voice: null,
                   rate: 1.0,
                   pitch: 1.0, 
                   volume: 1.0,
                   lang: 'zh-CN'
               };
               
               speechManager.log('ğŸ“ ä½¿ç”¨æœ€ç®€é…ç½®æµ‹è¯•...', 'info');
               speechManager.speakWithCustomConfig('è¿™æ˜¯å‡¶ç¥è¯­éŸ³æµ‹è¯•', simpleConfig, { interrupt: true });
               
               // å†æµ‹è¯•å®é™…å‡¶ç¥æ•°æ®
               setTimeout(() => {
                   speechManager.log('ğŸ“ ä½¿ç”¨å®é™…å‡¶ç¥æ•°æ®æµ‹è¯•...', 'info');
                   const testCard = {
                       type: 'inauspicious',
                       category: 'å‡¶æ˜Ÿå‡¶ç¥',
                       name: 'æµ‹è¯•å‡¶ç¥',
                       callsign: 'TEST-MALE',
                       motto: 'è¿™æ˜¯æµ‹è¯•å°è¯'
                   };
                   speechManager.speakEntranceQuote(testCard);
               }, 3000);
               
               // æœ€åæµ‹è¯•ç³»ç»Ÿç¬¬ä¸€ä¸ªè¯­éŸ³
               setTimeout(() => {
                   const voices = speechSynthesis.getVoices();
                   if (voices.length > 0) {
                       speechManager.log(`ğŸ“ ä½¿ç”¨ç³»ç»Ÿç¬¬ä¸€ä¸ªè¯­éŸ³æµ‹è¯•: ${voices[0].name}`, 'info');
                       const forceConfig = {
                           voice: voices[0],
                           rate: 0.9,
                           pitch: 0.9,
                           volume: 1.0,
                           lang: 'zh-CN'
                       };
                       speechManager.speakWithCustomConfig('å¼ºåˆ¶ä½¿ç”¨ç¬¬ä¸€ä¸ªè¯­éŸ³çš„å‡¶ç¥æµ‹è¯•', forceConfig, { interrupt: true });
                   }
               }, 6000);
           }
           
                       function testSpecificMaleVoice() {
                speechManager.log('ğŸ‘¨ ä¸“é—¨æµ‹è¯•ä¸­æ–‡ç”·æ€§è¯­éŸ³...', 'info');
                const maleVoices = speechManager.getMaleVoices();
                const femaleVoices = speechManager.getFemaleVoices();
                const allVoices = speechSynthesis.getVoices();
                
                speechManager.log(`ğŸ“‹ ç³»ç»Ÿè¯­éŸ³æ€»æ•°: ${allVoices.length}`, 'info');
                speechManager.log(`ğŸ‘¨ è¯†åˆ«çš„ç”·æ€§è¯­éŸ³æ•°: ${maleVoices.length}`, 'info');
                speechManager.log(`ğŸ‘© è¯†åˆ«çš„å¥³æ€§è¯­éŸ³æ•°: ${femaleVoices.length}`, 'info');
                
                // æ˜¾ç¤ºæ‰€æœ‰ç”·æ€§è¯­éŸ³çš„è¯¦ç»†ä¿¡æ¯
                speechManager.log('ğŸ‘¨ ç”·æ€§è¯­éŸ³è¯¦ç»†åˆ—è¡¨:', 'info');
                maleVoices.forEach((voice, index) => {
                    speechManager.log(`  ${index}: ${voice.name} (${voice.lang}) - URI: ${voice.voiceURI}`, 'info');
                });
                
                // æ˜¾ç¤ºæ‰€æœ‰å¥³æ€§è¯­éŸ³çš„è¯¦ç»†ä¿¡æ¯
                speechManager.log('ğŸ‘© å¥³æ€§è¯­éŸ³è¯¦ç»†åˆ—è¡¨:', 'info');
                femaleVoices.forEach((voice, index) => {
                    speechManager.log(`  ${index}: ${voice.name} (${voice.lang}) - URI: ${voice.voiceURI}`, 'info');
                });
                
                if (maleVoices.length > 0) {
                    const selectedVoice = maleVoices[0];
                    speechManager.log(`ğŸ¤ å‡†å¤‡ä½¿ç”¨ç”·æ€§è¯­éŸ³: ${selectedVoice.name} (${selectedVoice.lang})`, 'info');
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸ºä¸­æ–‡è¯­éŸ³
                    const isChinese = selectedVoice.lang.toLowerCase().includes('zh') || 
                                     selectedVoice.name.toLowerCase().includes('chinese') ||
                                     selectedVoice.name.toLowerCase().includes('mandarin');
                    
                    // æ£€æŸ¥æ˜¯å¦çœŸçš„æ˜¯ç”·æ€§è¯­éŸ³
                    const voiceName = selectedVoice.name.toLowerCase();
                    const isTrueMale = voiceName.includes('male') || 
                                      voiceName.includes('man') || 
                                      voiceName.includes('åº·åº·') ||
                                      voiceName.includes('äº‘æ‰¬');
                    
                    if (!isChinese) {
                        speechManager.log('âš ï¸ è­¦å‘Šï¼šé€‰ä¸­çš„ç”·æ€§è¯­éŸ³ä¸æ˜¯ä¸­æ–‡è¯­éŸ³ï¼', 'warning');
                    }
                    
                    if (!isTrueMale) {
                        speechManager.log('âš ï¸ è­¦å‘Šï¼šå¯èƒ½ä¸æ˜¯çœŸæ­£çš„ç”·æ€§è¯­éŸ³ï¼Œå°†è°ƒæ•´å‚æ•°æ¨¡æ‹Ÿï¼', 'warning');
                    }
                    
                    const maleConfig = {
                        voice: selectedVoice,
                        rate: isTrueMale ? 0.9 : 0.8,          // å¦‚æœä¸æ˜¯çœŸç”·å£°ï¼Œæ”¾æ…¢è¯­é€Ÿ
                        pitch: isTrueMale ? 0.8 : 0.6,         // å¦‚æœä¸æ˜¯çœŸç”·å£°ï¼Œå¤§å¹…é™ä½éŸ³è°ƒ
                        volume: 1.0,
                        lang: 'zh-CN'
                    };
                    
                    speechManager.log(`ğŸ”§ ä½¿ç”¨é…ç½®: è¯­é€Ÿ${maleConfig.rate}, éŸ³è°ƒ${maleConfig.pitch}, éŸ³é‡${maleConfig.volume}`, 'info');
                    speechManager.speakWithCustomConfig('è¿™æ˜¯ä¸­æ–‡ç”·æ€§è¯­éŸ³æµ‹è¯•ï¼Œå£°éŸ³åº”è¯¥ä½æ²‰æœ‰åŠ›', maleConfig, { interrupt: true });
                } else {
                    speechManager.log('âŒ æ²¡æœ‰è¯†åˆ«åˆ°ç”·æ€§è¯­éŸ³ï¼å°è¯•æ‰‹åŠ¨æŸ¥æ‰¾...', 'error');
                    
                    // æ‰‹åŠ¨æŸ¥æ‰¾ä¸­æ–‡ç”·æ€§è¯­éŸ³
                    const chineseMaleVoice = allVoices.find(voice => {
                        const lang = voice.lang.toLowerCase();
                        const name = voice.name.toLowerCase();
                        const isChinese = lang.includes('zh-cn') || lang.includes('zh_cn') || lang.startsWith('zh-');
                        const isMale = name.includes('male') || name.includes('ç”·') || name.includes('kangkang') || name.includes('yunxi');
                        return isChinese && isMale;
                    });
                    
                    if (chineseMaleVoice) {
                        speechManager.log(`ğŸ¯ æ‰‹åŠ¨æ‰¾åˆ°ä¸­æ–‡ç”·æ€§è¯­éŸ³: ${chineseMaleVoice.name} (${chineseMaleVoice.lang})`, 'success');
                        const maleConfig = {
                            voice: chineseMaleVoice,
                            rate: 0.9,
                            pitch: 0.8,
                            volume: 1.0,
                            lang: 'zh-CN'
                        };
                        speechManager.speakWithCustomConfig('æ‰‹åŠ¨æ‰¾åˆ°çš„ä¸­æ–‡ç”·æ€§è¯­éŸ³æµ‹è¯•', maleConfig, { interrupt: true });
                    } else {
                        speechManager.log('âŒ ç³»ç»Ÿä¸­æ²¡æœ‰ä¸­æ–‡ç”·æ€§è¯­éŸ³ï¼', 'error');
                        
                        // ä½¿ç”¨å¥³æ€§è¯­éŸ³ä½†å¤§å¹…è°ƒæ•´å‚æ•°æ¨¡æ‹Ÿç”·å£°
                        if (femaleVoices.length > 0) {
                            const femaleVoiceAsMale = femaleVoices[0];
                            speechManager.log(`ğŸ”„ ä½¿ç”¨å¥³æ€§è¯­éŸ³æ¨¡æ‹Ÿç”·å£°: ${femaleVoiceAsMale.name}`, 'warning');
                            const mockMaleConfig = {
                                voice: femaleVoiceAsMale,
                                rate: 0.7,   // æ›´æ…¢è¯­é€Ÿ
                                pitch: 0.5,  // æä½éŸ³è°ƒ
                                volume: 1.0,
                                lang: 'zh-CN'
                            };
                            speechManager.speakWithCustomConfig('ä½¿ç”¨å¥³å£°æ¨¡æ‹Ÿç”·å£°æµ‹è¯•ï¼ŒéŸ³è°ƒåº”è¯¥å¾ˆä½æ²‰', mockMaleConfig, { interrupt: true });
                        }
                    }
                }
            }
            
            function testSpecificFemaleVoice() {
                speechManager.log('ğŸ‘© ä¸“é—¨æµ‹è¯•å¥³æ€§è¯­éŸ³...', 'info');
                const femaleVoices = speechManager.getFemaleVoices();
                const allVoices = speechSynthesis.getVoices();
                
                if (femaleVoices.length > 0) {
                    speechManager.log(`ğŸ¤ ä½¿ç”¨å¥³æ€§è¯­éŸ³: ${femaleVoices[0].name}`, 'info');
                    const femaleConfig = {
                        voice: femaleVoices[0],
                        rate: 1.0,
                        pitch: 1.2,
                        volume: 1.0,
                        lang: 'zh-CN'
                    };
                    speechManager.speakWithCustomConfig('è¿™æ˜¯å¥³æ€§è¯­éŸ³æµ‹è¯•ï¼Œå£°éŸ³åº”è¯¥æ¸…æ™°æ‚¦è€³', femaleConfig, { interrupt: true });
                } else {
                    speechManager.log('âŒ æ²¡æœ‰è¯†åˆ«åˆ°å¥³æ€§è¯­éŸ³ï¼', 'error');
                }
            }
            
            function testVoiceSwitching() {
                speechManager.log('ğŸ”„ æµ‹è¯•è¯­éŸ³åˆ‡æ¢æœºåˆ¶...', 'info');
                
                const allVoices = speechSynthesis.getVoices();
                if (allVoices.length < 2) {
                    speechManager.log('âŒ ç³»ç»Ÿè¯­éŸ³æ•°é‡ä¸è¶³ï¼Œæ— æ³•æµ‹è¯•åˆ‡æ¢', 'error');
                    return;
                }
                
                // ç¬¬ä¸€æ­¥ï¼šæ’­æ”¾å¥³å£°
                speechManager.log('ğŸ‘© ç¬¬1æ­¥ï¼šæ’­æ”¾å¥³å£°...', 'info');
                const femaleConfig = {
                    voice: allVoices[0],
                    rate: 1.0,
                    pitch: 1.2,
                    volume: 1.0,
                    lang: 'zh-CN'
                };
                speechManager.speakWithCustomConfig('æˆ‘æ˜¯å¥³æ€§è¯­éŸ³æµ‹è¯•', femaleConfig, { interrupt: true });
                
                // ç¬¬äºŒæ­¥ï¼šåˆ‡æ¢åˆ°ç”·å£°
                setTimeout(() => {
                    speechManager.log('ğŸ‘¨ ç¬¬2æ­¥ï¼šåˆ‡æ¢åˆ°ç”·å£°...', 'info');
                    
                    // å¯»æ‰¾å¯èƒ½çš„ç”·æ€§è¯­éŸ³
                    const possibleMaleVoice = allVoices.find(voice => {
                        const name = voice.name.toLowerCase();
                        return name.includes('male') || name.includes('david') || name.includes('mark') || 
                               name.includes('ç”·') || name.includes('kangkang') || name.includes('yunxi');
                    }) || allVoices[Math.min(1, allVoices.length - 1)];
                    
                    const maleConfig = {
                        voice: possibleMaleVoice,
                        rate: 0.9,
                        pitch: 0.8,
                        volume: 1.0,
                        lang: 'zh-CN'
                    };
                    
                    speechManager.log(`ğŸ¤ ä½¿ç”¨è¯­éŸ³: ${possibleMaleVoice.name}`, 'info');
                    speechManager.speakWithCustomConfig('æˆ‘æ˜¯ç”·æ€§è¯­éŸ³æµ‹è¯•', maleConfig, { interrupt: true });
                }, 4000);
                
                // ç¬¬ä¸‰æ­¥ï¼šå¿«é€Ÿåˆ‡æ¢æµ‹è¯•
                setTimeout(() => {
                    speechManager.log('âš¡ ç¬¬3æ­¥ï¼šå¿«é€Ÿåˆ‡æ¢æµ‹è¯•...', 'info');
                    speechManager.speakWithCustomConfig('å¿«é€Ÿåˆ‡æ¢å¥³å£°', femaleConfig, { interrupt: true });
                }, 8000);
                
                setTimeout(() => {
                    const maleConfig = {
                        voice: allVoices[Math.min(1, allVoices.length - 1)],
                        rate: 0.9,
                        pitch: 0.8,
                        volume: 1.0,
                        lang: 'zh-CN'
                    };
                    speechManager.speakWithCustomConfig('å¿«é€Ÿåˆ‡æ¢ç”·å£°', maleConfig, { interrupt: true });
                }, 10000);
            }
            
            function testMaleVoicePrewarm() {
                speechManager.log('ğŸ”¥ æµ‹è¯•ç”·æ€§è¯­éŸ³é¢„çƒ­æœºåˆ¶...', 'info');
                
                const allVoices = speechSynthesis.getVoices();
                const maleVoices = speechManager.getMaleVoices();
                
                speechManager.log(`ğŸ“‹ ç³»ç»Ÿè¯­éŸ³æ€»æ•°: ${allVoices.length}`, 'info');
                speechManager.log(`ğŸ‘¨ è¯†åˆ«çš„ç”·æ€§è¯­éŸ³æ•°: ${maleVoices.length}`, 'info');
                
                if (maleVoices.length === 0) {
                    speechManager.log('âŒ æ²¡æœ‰è¯†åˆ«åˆ°ç”·æ€§è¯­éŸ³ï¼Œä½¿ç”¨ç³»ç»Ÿç¬¬ä¸€ä¸ªè¯­éŸ³', 'warning');
                    
                    if (allVoices.length > 0) {
                        testSingleMaleVoice(allVoices[0], 'ç³»ç»Ÿé»˜è®¤è¯­éŸ³(æ¨¡æ‹Ÿç”·å£°)');
                    }
                } else {
                    // æµ‹è¯•ç¬¬ä¸€ä¸ªç”·æ€§è¯­éŸ³
                    testSingleMaleVoice(maleVoices[0], 'è¯†åˆ«çš„ç”·æ€§è¯­éŸ³');
                }
                
                function testSingleMaleVoice(voice, description) {
                    speechManager.log(`ğŸ¤ æµ‹è¯•${description}: ${voice.name}`, 'info');
                    
                    // æ­¥éª¤1ï¼šé¢„çƒ­è¯­éŸ³
                    speechManager.log('ğŸ”¥ æ­¥éª¤1ï¼šé¢„çƒ­è¯­éŸ³...', 'info');
                    const warmUpUtterance = new SpeechSynthesisUtterance(' ');
                    warmUpUtterance.voice = voice;
                    warmUpUtterance.volume = 0; // é™éŸ³é¢„çƒ­
                    warmUpUtterance.rate = 1.0;
                    warmUpUtterance.pitch = 1.0;
                    
                    warmUpUtterance.onend = () => {
                        speechManager.log('âœ… é¢„çƒ­å®Œæˆï¼Œå¼€å§‹æ’­æ”¾...', 'success');
                        
                        // æ­¥éª¤2ï¼šæ’­æ”¾æµ‹è¯•è¯­éŸ³
                        setTimeout(() => {
                            const testConfig = {
                                voice: voice,
                                rate: 0.9,
                                pitch: 0.8,
                                volume: 1.0,
                                lang: 'zh-CN'
                            };
                            speechManager.speakWithCustomConfig('ç”·æ€§è¯­éŸ³é¢„çƒ­æµ‹è¯•æˆåŠŸï¼Œè¿™æ˜¯ç¾Šåˆƒçš„å…¥åœºå°è¯', testConfig, { interrupt: true });
                        }, 500);
                    };
                    
                    warmUpUtterance.onerror = (event) => {
                        speechManager.log(`âŒ é¢„çƒ­å¤±è´¥: ${event.error}`, 'error');
                    };
                    
                    speechSynthesis.speak(warmUpUtterance);
                }
            }
            
            function testYangrenSpecific() {
               speechManager.log('âš”ï¸ ä¸“é—¨æµ‹è¯•ç¾Šåˆƒè¯­éŸ³æ’­æ”¾...', 'info');
               
               // å®Œå…¨æŒ‰ç…§æ¸¸æˆä¸­çš„ç¾Šåˆƒæ•°æ®ç»“æ„
               const yangrenData = {
                   id: 'yangren',
                   name: 'ç¾Šåˆƒ',
                   callsign: 'BERSERKER-X',
                   classification: 'SSSçº§å¤±æ§å‹æ”»å‡»å•ä½',
                   designation: 'BERSERKER-XÂ·SSSçº§å¤±æ§å‹æ”»å‡»å•ä½',
                   psyProfile: 'è¶…é«˜æ”»å‡»æ€§ï¼Œæˆ˜æ–—æˆç˜¾ï¼Œå®‰å…¨åè®®å·²æŸåï¼Œå­˜åœ¨å‹ä¼¤é£é™©',
                   motto: 'è¡€æ¶²ç¼–è¯‘ä¸­...ç›®æ ‡é”å®š...å¼€å§‹å± æˆ®ç¨‹åºï¼',
                   category: 'å‡¶æ˜Ÿå‡¶ç¥',
                   rarity: 'â­â­â­',
                   element: 'ç«',
                   power: 3,
                   type: 'inauspicious'
               };
               
               speechManager.log('ğŸ“‹ ç¾Šåˆƒå®Œæ•´æ•°æ®:', 'info');
               speechManager.log(JSON.stringify(yangrenData, null, 2), 'info');
               
               // å…ˆæµ‹è¯•æœ€ç®€å•çš„ç›´æ¥æ’­æ”¾
               speechManager.log('ğŸ¤ ç¬¬1æ­¥ï¼šç›´æ¥æ’­æ”¾ç¾Šåˆƒå°è¯...', 'info');
               const simpleConfig = {
                   voice: null,
                   rate: 1.0,
                   pitch: 1.0,
                   volume: 1.0,
                   lang: 'zh-CN'
               };
               speechManager.speakWithCustomConfig('ç¥ç…ç¾Šåˆƒï¼Œå…¥åœºï¼è¡€æ¶²ç¼–è¯‘ä¸­ï¼Œç›®æ ‡é”å®šï¼Œå¼€å§‹å± æˆ®ç¨‹åºï¼', simpleConfig, { interrupt: true });
               
               // å†æµ‹è¯•å¸¦ç”·å£°é…ç½®
               setTimeout(() => {
                   speechManager.log('ğŸ¤ ç¬¬2æ­¥ï¼šä½¿ç”¨ç”·å£°é…ç½®æ’­æ”¾...', 'info');
                   const allVoices = speechSynthesis.getVoices();
                   const maleConfig = {
                       voice: allVoices.length > 0 ? allVoices[0] : null,
                       rate: 0.9,
                       pitch: 0.9,
                       volume: 1.0,
                       lang: 'zh-CN'
                   };
                   speechManager.speakWithCustomConfig('ç‹‚æˆ˜å£«Xï¼Œè¡€æ¶²ç¼–è¯‘ä¸­ï¼Œå¼€å§‹å± æˆ®ç¨‹åºï¼', maleConfig, { interrupt: true });
               }, 4000);
               
               // æœ€åæµ‹è¯•å®Œæ•´çš„å…¥åœºè¯­éŸ³å‡½æ•°
               setTimeout(() => {
                   speechManager.log('ğŸ¤ ç¬¬3æ­¥ï¼šä½¿ç”¨å®Œæ•´å…¥åœºè¯­éŸ³å‡½æ•°...', 'info');
                   speechManager.speakEntranceQuote(yangrenData);
               }, 8000);
               
               // é¢å¤–æµ‹è¯•ï¼šå¼ºåˆ¶ç®€åŒ–ç‰ˆæœ¬
               setTimeout(() => {
                   speechManager.log('ğŸ¤ ç¬¬4æ­¥ï¼šå¼ºåˆ¶ç®€åŒ–ç‰ˆæœ¬...', 'info');
                   speechManager.speak('ç¾Šåˆƒå…¥åœºï¼è¡€æ¶²ç¼–è¯‘ä¸­ï¼', 'entrance', { interrupt: true });
               }, 12000);
           }
          
                       function showVoiceSelector() {
                const allVoices = speechSynthesis.getVoices();
                const voiceButtonsContainer = document.getElementById('voiceButtons');
                const voiceSelector = document.getElementById('voiceSelector');
                
                speechManager.log('ğŸ›ï¸ æ˜¾ç¤ºè¯­éŸ³é€‰æ‹©å™¨...', 'info');
                
                // æ¸…ç©ºä¹‹å‰çš„æŒ‰é’®
                voiceButtonsContainer.innerHTML = '';
                
                // ä¸ºæ¯ä¸ªè¯­éŸ³åˆ›å»ºæµ‹è¯•æŒ‰é’®
                allVoices.forEach((voice, index) => {
                    const button = document.createElement('button');
                    const voiceInfo = `${index}: ${voice.name} (${voice.lang})`;
                    button.textContent = voiceInfo;
                    button.style.cssText = `
                        padding: 8px 12px;
                        margin: 2px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        background-color: white;
                        cursor: pointer;
                        font-size: 12px;
                        text-align: left;
                    `;
                    
                    button.onclick = () => testSpecificVoiceByIndex(index, voice);
                    voiceButtonsContainer.appendChild(button);
                });
                
                voiceSelector.style.display = 'block';
                speechManager.log(`ğŸ“‹ ç”Ÿæˆäº†${allVoices.length}ä¸ªè¯­éŸ³æµ‹è¯•æŒ‰é’®`, 'info');
            }
            
            function hideVoiceSelector() {
                document.getElementById('voiceSelector').style.display = 'none';
            }
            
            function testSpecificVoiceByIndex(index, voice) {
                speechManager.log(`ğŸ¤ æµ‹è¯•è¯­éŸ³ ${index}: ${voice.name}`, 'info');
                
                const testConfig = {
                    voice: voice,
                    rate: 1.0,
                    pitch: 1.0,
                    volume: 1.0,
                    lang: voice.lang || 'zh-CN'
                };
                
                const testText = `æˆ‘æ˜¯ç¬¬${index}å·è¯­éŸ³ï¼Œ${voice.name}ï¼Œæ­£åœ¨ä¸ºæ‚¨æ’­æŠ¥æµ‹è¯•å†…å®¹`;
                speechManager.speakWithCustomConfig(testText, testConfig, { interrupt: true });
            }
            
            function testAllVoicesSequentially() {
                const allVoices = speechSynthesis.getVoices();
                speechManager.log(`ğŸ”„ å¼€å§‹é€ä¸ªæµ‹è¯•${allVoices.length}ä¸ªè¯­éŸ³...`, 'info');
                
                let currentIndex = 0;
                
                function testNextVoice() {
                    if (currentIndex >= allVoices.length) {
                        speechManager.log('âœ… æ‰€æœ‰è¯­éŸ³æµ‹è¯•å®Œæˆï¼', 'success');
                        return;
                    }
                    
                    const voice = allVoices[currentIndex];
                    speechManager.log(`ğŸ¤ æµ‹è¯•ç¬¬${currentIndex}ä¸ªè¯­éŸ³: ${voice.name}`, 'info');
                    
                    const testConfig = {
                        voice: voice,
                        rate: 1.0,
                        pitch: 1.0,
                        volume: 1.0,
                        lang: voice.lang || 'zh-CN'
                    };
                    
                    const testText = `ç¬¬${currentIndex}å·ï¼Œ${voice.name}`;
                    
                    // åˆ›å»ºè¯­éŸ³å®ä¾‹å¹¶è®¾ç½®å®Œæˆå›è°ƒ
                    const utterance = new SpeechSynthesisUtterance(testText);
                    utterance.voice = voice;
                    utterance.rate = testConfig.rate;
                    utterance.pitch = testConfig.pitch;
                    utterance.volume = testConfig.volume;
                    utterance.lang = testConfig.lang;
                    
                    utterance.onend = () => {
                        currentIndex++;
                        setTimeout(testNextVoice, 1000); // é—´éš”1ç§’æµ‹è¯•ä¸‹ä¸€ä¸ª
                    };
                    
                    utterance.onerror = () => {
                        speechManager.log(`âŒ è¯­éŸ³${currentIndex}æ’­æ”¾å¤±è´¥`, 'error');
                        currentIndex++;
                        setTimeout(testNextVoice, 500);
                    };
                    
                    speechSynthesis.speak(utterance);
                }
                
                testNextVoice();
            }
            
            function clearLog() {
                document.getElementById('logPanel').innerHTML = '';
            }
    </script>
</body>
</html> 