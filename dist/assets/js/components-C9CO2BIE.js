var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{r as s,j as a}from"./react-vendor-DMglIiRN.js";import{P as l,d as i}from"./game-vendor-euAipthA.js";const r=({scene:e,onDeal:t,onHit:l,onStand:i,onNewGame:r})=>{const[n,d]=s.useState({playerScore:0,dealerScore:"?",gameStarted:!1,gameOver:!1,wins:0,losses:0}),[c,h]=s.useState(""),[o,m]=s.useState(!1);s.useEffect(()=>{const t=e=>{d(e)},s=e=>{h(e.result),m(!0),setTimeout(()=>m(!1),3e3)},a=()=>{h(""),m(!1)};return e.events.on("stateUpdate",t),e.events.on("gameEnd",s),e.events.on("newGame",a),()=>{e.events.off("stateUpdate",t),e.events.off("gameEnd",s),e.events.off("newGame",a)}},[e]);const p=n.wins+n.losses>0?Math.round(n.wins/(n.wins+n.losses)*100):0;return a.jsxs("div",{className:"fixed inset-0 pointer-events-none",children:[a.jsx("div",{className:"absolute top-4 left-4 bg-black bg-opacity-70 text-white p-4 rounded-lg pointer-events-auto",children:a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"庄家分数:"}),a.jsx("span",{className:"font-bold",children:n.dealerScore})]}),a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"玩家分数:"}),a.jsx("span",{className:"font-bold",children:n.playerScore})]}),(n.wins>0||n.losses>0)&&a.jsxs(a.Fragment,{children:[a.jsx("hr",{className:"border-gray-500"}),a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"胜利:"}),a.jsx("span",{className:"text-green-400 font-bold",children:n.wins})]}),a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"失败:"}),a.jsx("span",{className:"text-red-400 font-bold",children:n.losses})]}),a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"胜率:"}),a.jsxs("span",{className:"text-yellow-400 font-bold",children:[p,"%"]})]})]})]})}),o&&a.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-90 text-white p-6 rounded-xl text-center pointer-events-auto",children:[a.jsx("div",{className:"text-2xl font-bold mb-2",children:"🎉"}),a.jsx("div",{className:"text-lg font-bold",children:c})]}),a.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-3 pointer-events-auto",children:[!n.gameStarted&&!n.gameOver&&a.jsx("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg",children:"🎴 发牌"}),n.gameStarted&&!n.gameOver&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:l,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg",children:"🎯 要牌"}),a.jsx("button",{onClick:i,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg",children:"✋ 停牌"})]}),n.gameOver&&a.jsx("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg",children:"🔄 再来一局"}),a.jsx("button",{onClick:r,className:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg",children:"🎮 新游戏"})]}),a.jsxs("div",{className:"absolute top-4 right-4 bg-black bg-opacity-70 text-white p-4 rounded-lg pointer-events-auto max-w-sm",children:[a.jsx("h3",{className:"font-bold text-lg mb-2",children:"🎯 游戏规则"}),a.jsxs("ul",{className:"text-sm space-y-1",children:[a.jsx("li",{children:"• 目标：让手牌总分接近21点"}),a.jsx("li",{children:"• A可以是1点或11点"}),a.jsx("li",{children:"• J、Q、K都是10点"}),a.jsx("li",{children:"• 超过21点即爆牌"}),a.jsx("li",{children:"• 庄家17点以下必须要牌"})]})]})]})};class n extends l.Scene{constructor(){super({key:"ViteBlackjackScene"}),t(this,"deck",[]),t(this,"playerHand",[]),t(this,"dealerHand",[]),t(this,"gameOver",!1),t(this,"gameStarted",!1),t(this,"wins",0),t(this,"losses",0),t(this,"ui")}preload(){this.createCardAssets()}createCardAssets(){this.add.graphics().fillStyle(1722272).fillRoundedRect(0,0,100,140,12).lineStyle(4,16777215).strokeRoundedRect(0,0,100,140,12).generateTexture("cardBack",100,140);const e=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];["♠","♥","♦","♣"].forEach(t=>{e.forEach(e=>{const s=this.add.graphics();s.fillStyle(16777215).fillRoundedRect(0,0,100,140,12).lineStyle(4,3355443).strokeRoundedRect(0,0,100,140,12),s.generateTexture(`card_${t}_${e}`,100,140),s.destroy()})})}create(){const e=this.add.graphics();e.fillGradientStyle(1727002,1727002,999183,999183),e.fillRect(0,0,800,600);for(let t=0;t<20;t++)this.add.circle(l.Math.Between(0,800),l.Math.Between(0,600),l.Math.Between(3,8),16777215,.1);this.add.text(400,50,"🎮 Vite + Phaser 21点游戏",{fontSize:"32px",color:"#ffffff",fontFamily:"Arial"}).setOrigin(.5),this.ui=new i.Interface(this),this.ui.render(r,{scene:this,onDeal:()=>this.dealCards(),onHit:()=>this.hit(),onStand:()=>this.stand(),onNewGame:()=>this.newGame()}),this.initializeDeck(),this.updateGameState()}initializeDeck(){this.deck=[];const e=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];["♠","♥","♦","♣"].forEach(t=>{e.forEach(e=>{const s={suit:t,value:e,textureKey:`card_${t}_${e}`};this.deck.push(s)})}),this.shuffleDeck()}shuffleDeck(){for(let e=this.deck.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this.deck[e],this.deck[t]]=[this.deck[t],this.deck[e]]}}dealCards(){this.gameStarted||(this.deck.length<4&&this.initializeDeck(),this.gameStarted=!0,this.gameOver=!1,this.playerHand=[],this.dealerHand=[],this.time.delayedCall(300,()=>{const e=this.deck.pop();e&&(this.playerHand.push(e),this.updateDisplay())}),this.time.delayedCall(600,()=>{const e=this.deck.pop();e&&(this.dealerHand.push(e),this.updateDisplay())}),this.time.delayedCall(900,()=>{const e=this.deck.pop();e&&(this.playerHand.push(e),this.updateDisplay())}),this.time.delayedCall(1200,()=>{const e=this.deck.pop();e&&(this.dealerHand.push(e),this.updateDisplay(),21===this.calculateScore(this.playerHand)&&this.time.delayedCall(1e3,()=>this.stand()))}),this.updateGameState())}hit(){if(this.gameOver||!this.gameStarted)return;0===this.deck.length&&this.initializeDeck();const e=this.deck.pop();if(e){this.playerHand.push(e),this.updateDisplay();const t=this.calculateScore(this.playerHand);t>21?this.endGame("玩家爆牌！庄家获胜！",!1):21===t&&this.time.delayedCall(500,()=>this.stand())}this.updateGameState()}stand(){if(this.gameOver||!this.gameStarted)return;const e=()=>{if(this.calculateScore(this.dealerHand)<17){0===this.deck.length&&this.initializeDeck();const t=this.deck.pop();t?(this.dealerHand.push(t),this.updateDisplay(),this.time.delayedCall(1e3,e)):this.resolveGame()}else this.resolveGame()};e()}resolveGame(){const e=this.calculateScore(this.playerHand),t=this.calculateScore(this.dealerHand);let s,a=!1;t>21?(s="庄家爆牌！玩家获胜！",a=!0):e>t?(s="玩家获胜！",a=!0):s=t>e?"庄家获胜！":"平局！",this.endGame(s,a)}endGame(e,t){this.gameOver=!0,this.gameStarted=!1,!0===t?this.wins++:!1===t&&this.losses++,this.updateDisplay(),this.updateGameState(),this.events.emit("gameEnd",{result:e,playerWins:t,wins:this.wins,losses:this.losses})}newGame(){this.wins=0,this.losses=0,this.gameOver=!1,this.gameStarted=!1,this.playerHand=[],this.dealerHand=[],this.initializeDeck(),this.clearCardDisplay(),this.updateGameState(),this.events.emit("newGame")}calculateScore(e){let t=0,s=0;for(e.forEach(e=>{"A"===e.value?(s++,t+=11):["J","Q","K"].includes(e.value)?t+=10:t+=parseInt(e.value)});t>21&&s>0;)t-=10,s--;return t}updateDisplay(){this.clearCardDisplay(),this.playerHand.forEach((e,t)=>{const s=200+110*t,a=this.add.image(s,450,e.textureKey).setScale(.8).setAlpha(0),l="10"===e.value?"12px":"16px",i="♥"===e.suit||"♦"===e.suit?"#ff0000":"#000000",r=this.add.text(s,450,`${e.value}\n${e.suit}`,{fontSize:l,color:i,fontFamily:"Arial",align:"center"}).setOrigin(.5).setScale(.8).setAlpha(0);this.tweens.add({targets:[a,r],alpha:1,duration:400,delay:150*t,ease:"Back.easeOut"}),a.setName("playerCard"),r.setName("playerCard")}),this.dealerHand.forEach((e,t)=>{const s=200+110*t;let a,l=null;if(0!==t||this.gameOver){a=this.add.image(s,200,e.textureKey).setScale(.8).setAlpha(0);const t="10"===e.value?"12px":"16px",i="♥"===e.suit||"♦"===e.suit?"#ff0000":"#000000";l=this.add.text(s,200,`${e.value}\n${e.suit}`,{fontSize:t,color:i,fontFamily:"Arial",align:"center"}).setOrigin(.5).setScale(.8).setAlpha(0),l.setName("dealerCard")}else a=this.add.image(s,200,"cardBack").setScale(.8).setAlpha(0);const i=l?[a,l]:[a];this.tweens.add({targets:i,alpha:1,duration:400,delay:150*t,ease:"Back.easeOut"}),a.setName("dealerCard")})}clearCardDisplay(){this.children.list.filter(e=>"playerCard"===e.name||"dealerCard"===e.name).forEach(e=>{e.destroy()})}updateGameState(){const e=this.calculateScore(this.playerHand),t=this.gameOver?this.calculateScore(this.dealerHand):0;this.events.emit("stateUpdate",{playerScore:e,dealerScore:this.gameOver?t:"?",gameStarted:this.gameStarted,gameOver:this.gameOver,wins:this.wins,losses:this.losses})}getGameState(){return{playerScore:this.calculateScore(this.playerHand),dealerScore:this.gameOver?this.calculateScore(this.dealerHand):"?",gameStarted:this.gameStarted,gameOver:this.gameOver,wins:this.wins,losses:this.losses}}}const d=()=>{const e=s.useRef(null),t=s.useRef(null),[i,r]=s.useState(!1);return s.useEffect(()=>{const s={type:l.AUTO,width:800,height:600,parent:e.current,backgroundColor:"#1a5a1a",scene:n,physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scale:{mode:l.Scale.FIT,autoCenter:l.Scale.CENTER_BOTH}};return t.current=new l.Game(s),t.current.events.once("ready",()=>{r(!0)}),()=>{t.current&&(t.current.destroy(!0),t.current=null)}},[]),a.jsxs("div",{className:"flex flex-col items-center p-8 bg-gradient-to-br from-green-100 to-blue-100 min-h-screen",children:[a.jsxs("div",{className:"mb-6 text-center",children:[a.jsx("h1",{className:"text-4xl font-bold text-green-800 mb-2",children:"⚡ Vite + Phaser + React UI"}),a.jsx("p",{className:"text-green-600 text-lg",children:"高性能21点卡牌游戏"})]}),a.jsx("div",{ref:e,className:"border-4 border-green-600 rounded-2xl shadow-2xl overflow-hidden bg-white"}),!i&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50",children:a.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:"🎮 游戏加载中..."})}),a.jsxs("div",{className:"mt-8 max-w-4xl bg-white rounded-xl shadow-lg p-6",children:[a.jsx("h3",{className:"text-2xl font-bold text-green-800 mb-4 text-center",children:"🚀 技术特色"}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("h4",{className:"font-semibold text-green-700",children:"⚡ Vite优势"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:"• 极速热重载 (HMR)"}),a.jsx("li",{children:"• TypeScript原生支持"}),a.jsx("li",{children:"• 现代ES模块"}),a.jsx("li",{children:"• 优化的构建过程"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h4",{className:"font-semibold text-green-700",children:"🎮 游戏特性"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:"• React + Phaser集成"}),a.jsx("li",{children:"• 响应式缩放"}),a.jsx("li",{children:"• 流畅动画效果"}),a.jsx("li",{children:"• 事件驱动架构"})]})]})]})]})]})};export{d as V};
